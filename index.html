<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://statics.teams.cdn.office.net/sdk/v1.12.0/js/MicrosoftTeams.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f8f8f8; }
    .dashboard-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; }
    .chart-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; width: 400px; }
    h1 { text-align: center; }
    .nav-btn { display: block; margin: 30px auto 0 auto; padding: 12px 32px; font-size: 18px; background: #0078d4; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    .nav-btn:hover { background: #005fa3; }
  </style>
</head>
<body>
    <!-- Once Rejesot the app should show  -->
      <div id="userInfo" style="text-align:center; margin-bottom:18px; font-size:17px; color:#333;"></div>

  <h1>Dashboard</h1>
  <div class="dashboard-container">
    <div class="chart-card">
      <canvas id="chart1"></canvas>
    </div>
    <div class="chart-card">
      <canvas id="chart2"></canvas>
    </div>
    <div class="chart-card">
      <canvas id="chart3"></canvas>
    </div>
    <div class="chart-card">
      <canvas id="chart4"></canvas>
    </div>
  </div>
  <!-- <button class="nav-btn" onclick="window.location.href='content.html'">Go to Request Page</button> -->
  <script>
    // Table data
    const requests = [
      { id: 'REQ001', type: 'New Supplier', status: 'Approved', requester: 'Mohamed', manager: 'Ali', date: '2024-06-01' },
      { id: 'REQ002', type: 'Customer Account', status: 'Rejected', requester: 'Mohamed', manager: 'Ali', date: '2024-06-15' },
      { id: 'REQ003', type: 'Other', status: 'Pending', requester: 'Mohamed', manager: 'Hassan', date: '2024-07-01' },
      { id: 'REQ004', type: 'New Supplier', status: 'Not Approved', requester: 'Mohamed', manager: 'Mohamed', date: '2024-07-20' }
    ];

    // Chart 1: Requests by Type
    const typeCounts = {};
    requests.forEach(r => { typeCounts[r.type] = (typeCounts[r.type] || 0) + 1; });
    new Chart(document.getElementById('chart1'), {
      type: 'bar',
      data: {
        labels: Object.keys(typeCounts),
        datasets: [{
          label: 'Requests by Type',
          data: Object.values(typeCounts),
          backgroundColor: ['#0078d4', '#00bfae', '#ffb900']
        }]
      },
      options: { responsive: true, plugins: { title: { display: true, text: 'Requests by Type' } } }
    });

    // Chart 2: Requests by Status
    const statusCounts = {};
    requests.forEach(r => { statusCounts[r.status] = (statusCounts[r.status] || 0) + 1; });
    new Chart(document.getElementById('chart2'), {
      type: 'pie',
      data: {
        labels: Object.keys(statusCounts),
        datasets: [{
          label: 'Status',
          data: Object.values(statusCounts),
          backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#6c757d']
        }]
      },
      options: { responsive: true, plugins: { title: { display: true, text: 'Requests by Status' } } }
    });

    // Chart 3: Requests by Manager
    const managerCounts = {};
    requests.forEach(r => { managerCounts[r.manager] = (managerCounts[r.manager] || 0) + 1; });
    new Chart(document.getElementById('chart3'), {
      type: 'doughnut',
      data: {
        labels: Object.keys(managerCounts),
        datasets: [{
          label: 'Manager',
          data: Object.values(managerCounts),
          backgroundColor: ['#0078d4', '#00bfae', '#ffb900', '#dc3545']
        }]
      },
      options: { responsive: true, plugins: { title: { display: true, text: 'Requests by Manager' } } }
    });

    // Chart 4: Requests Over Time (by Month)
    const monthCounts = {};
    requests.forEach(r => {
      const month = r.date.slice(0, 7); // YYYY-MM
      monthCounts[month] = (monthCounts[month] || 0) + 1;
    });
    new Chart(document.getElementById('chart4'), {
      type: 'line',
      data: {
        labels: Object.keys(monthCounts),
        datasets: [{
          label: 'Requests per Month',
          data: Object.values(monthCounts),
          borderColor: '#0078d4',
          backgroundColor: 'rgba(0,120,212,0.1)',
          fill: true
        }]
      },
      options: { responsive: true, plugins: { title: { display: true, text: 'Requests Over Time' } } }
    });

microsoftTeams.app.initialize().then(() => {
  microsoftTeams.app.getContext().then((context) => {
    const userDisplayName = context.user?.displayName || "Unknown User";
    const userEmail = context.user?.email || context.user?.userPrincipalName || "Unknown Email";
    const userTenantId = context.user?.tenant?.id || context.app?.tenant?.id || context?.tenant?.id || "Unknown Tenant";

    document.getElementById('userInfo').innerHTML =
      `<strong>${userDisplayName}</strong> &nbsp;|&nbsp; ${userEmail} &nbsp;|&nbsp; Tenant ID: ${userTenantId}`;
  });
});

  </script>
</body>
</html>